<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Building a NSX-T nested lab with Eve-NG, virtualised switches, BGP, and the kitchen sink attached. &#183;</title><meta name=title content="Building a NSX-T nested lab with Eve-NG, virtualised switches, BGP, and the kitchen sink attached. &#183; "><link rel=canonical href=https://vxsan.com/posts/building-a-nsx-t-nested-lab/><link type=text/css rel=stylesheet href=/css/main.bundle.min.20ee20d15c36fc50e4068d3b8fd41f107c6a6f6718153e38bb4b63b0d1026475c68d1ccde37216f67b22cf2b6eec97c241a268bcaf7d2e0ebb9512af6492f9a2.css integrity="sha512-IO4g0Vw2/FDkBo07j9QfEHxqb2cYFT44u0tjsNECZHXGjRzN43IW9nsizytu7JfCQaJovK99Lg67lRKvZJL5og=="><script type=text/javascript src=/js/main.min.cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e.js integrity="sha512-z4PhNX7vuL3xVChQ1m2AB9Yg5AULVxXcg/SpIdNs6c5H0NE8XYXysP+DGNKHfuwvY7kxvUdBeoGlODJ6+SfaPg=="></script>
<script type=text/javascript src=/js/appearance.min.f94f4c4636d9e3ec8f5ee53cdc8ffa3d01bf87cd92ac85e6797550b1e2b80dc9118d838f3eb24c55109352455e72ff082dfe560283154e5a8f87fd75107b59c4.js integrity="sha512-+U9MRjbZ4+yPXuU83I/6PQG/h82SrIXmeXVQseK4DckRjYOPPrJMVRCTUkVecv8ILf5WAoMVTlqPh/11EHtZxA=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3ddcf04f5b0d4c32f72e726d3c12eebccd8c3c9f9daa9a13414808895de0ae1e1cdddda6849680d5bd96dbb60d0b1e0b24c29f5c83e5631e55e7e6bc02015490.js integrity="sha512-PdzwT1sNTDL3LnJtPBLuvM2MPJ+dqpoTQUgIiV3grh4c3d2mhJaA1b2W27YNCx4LJMKfXIPlYx5V5+a8AgFUkA==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Building a NSX-T nested lab with Eve-NG, virtualised switches, BGP, and the kitchen sink attached."><meta property="og:description" content="Since my last tweet and blogpost on a bug in NSX-T when deploying on a nested ESXi host , i&rsquo;ve had a few requests from people to describe the actual lab setup used, the procedure and a quick-and-dirty guide to get started with NSX-T on vSphere."><meta property="og:type" content="article"><meta property="og:url" content="https://vxsan.com/posts/building-a-nsx-t-nested-lab/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-04-29T12:23:52+00:00"><meta property="article:modified_time" content="2017-04-29T12:23:52+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a NSX-T nested lab with Eve-NG, virtualised switches, BGP, and the kitchen sink attached."><meta name=twitter:description content="Since my last tweet and blogpost on a bug in NSX-T when deploying on a nested ESXi host , i&rsquo;ve had a few requests from people to describe the actual lab setup used, the procedure and a quick-and-dirty guide to get started with NSX-T on vSphere."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Building a NSX-T nested lab with Eve-NG, virtualised switches, BGP, and the kitchen sink attached.","headline":"Building a NSX-T nested lab with Eve-NG, virtualised switches, BGP, and the kitchen sink attached.","abstract":"Since my last tweet and blogpost on a bug in NSX-T when deploying on a nested ESXi host , i\u0026rsquo;ve had a few requests from people to describe the actual lab setup used, the procedure and a quick-and-dirty guide to get started with NSX-T on vSphere.","inLanguage":"en","url":"https:\/\/vxsan.com\/posts\/building-a-nsx-t-nested-lab\/","author":{"@type":"Person","name":"Sjors Robroek"},"copyrightYear":"2017","dateCreated":"2017-04-29T12:23:52\u002b00:00","datePublished":"2017-04-29T12:23:52\u002b00:00","dateModified":"2017-04-29T12:23:52\u002b00:00","keywords":["NSX-T","blogposts"],"mainEntityOfPage":"true","wordCount":"5967"}]</script><meta name=author content="Sjors Robroek"><link href=https://github.com/srobroek rel=me><link href=https://keybase.io/srobroek rel=me><link href=https://linkedin.com/in/srobroek rel=me><link href=https://twitter.com/ctopope rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0 class="flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900"></a></nav><div class="hidden md:flex items-center space-x-5 md:ml-12"><a href=/posts/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=Posts>Blog</a>
<a href=/categories/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=Categories>Categories</a>
<a href=/tags/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=Tags>Tags</a>
<a href=/about/ class="text-base font-medium text-gray-500 hover:text-gray-900" title>About</a>
<a href=https://github.com/srobroek class="text-base font-medium text-gray-500 hover:text-gray-900" title><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a href=https://keybase.io/srobroek class="text-base font-medium text-gray-500 hover:text-gray-900" title><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M286.17 419a18 18 0 1018 18 18 18 0 00-18-18zm111.92-147.6c-9.5-14.62-39.37-52.45-87.26-73.71q-9.1-4.06-18.38-7.27A78.43 78.43.0 00244.57 86.29c-12.41-4.1-23.33-6-32.41-5.77-.6-2-1.89-11 9.4-35L198.66 32l-5.48 7.56c-8.69 12.06-16.92 23.55-24.34 34.89a51 51 0 00-8.29-1.25c-41.53-2.45-39-2.33-41.06-2.33-50.61.0-50.75 52.12-50.75 45.88l-2.36 36.68c-1.61 27 19.75 50.21 47.63 51.85l8.93.54a214 214 0 00-46.29 35.54C14 304.66 14 374 14 429.77v33.64l23.32-29.8a148.6 148.6.0 0014.56 37.56c5.78 10.13 14.87 9.45 19.64 7.33 4.21-1.87 10-6.92 3.75-20.11a178.29 178.29.0 01-15.76-53.13l46.82-59.83-24.66 74.11c58.23-42.4 157.38-61.76 236.25-38.59 34.2 10.05 67.45.69 84.74-23.84.72-1 1.2-2.16 1.85-3.22a156.09 156.09.0 012.8 28.43c0 23.3-3.69 52.93-14.88 81.64-2.52 6.46 1.76 14.5 8.6 15.74 7.42 1.57 15.33-3.1 18.37-11.15C429 443 434 414 434 382.32c0-38.58-13-77.46-35.91-110.92zM142.37 128.58l-15.7-.93-1.39 21.79 13.13.78a93 93 0 00.32 19.57l-22.38-1.34a12.28 12.28.0 01-11.76-12.79L107 119c1-12.17 13.87-11.27 13.26-11.32l29.11 1.73a144.35 144.35.0 00-7 19.17zm148.42 172.18a10.51 10.51.0 01-14.35-1.39l-9.68-11.49-34.42 27a8.09 8.09.0 01-11.13-1.08l-15.78-18.64a7.38 7.38.0 011.34-10.34l34.57-27.18-14.14-16.74-17.09 13.45a7.75 7.75.0 01-10.59-1s-3.72-4.42-3.8-4.53a7.38 7.38.0 011.37-10.34L214 225.19s-18.51-22-18.6-22.14a9.56 9.56.0 011.74-13.42 10.38 10.38.0 0114.3 1.37l81.09 96.32a9.58 9.58.0 01-1.74 13.44zM187.44 419a18 18 0 1018 18 18 18 0 00-18-18z"/></svg></span></a><a href=https://linkedin.com/in/srobroek class="text-base font-medium text-gray-500 hover:text-gray-900" title><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a href=https://twitter.com/ctopope class="text-base font-medium text-gray-500 hover:text-gray-900" title><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:25px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex movedown flex-col w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl sm:px-14 md:px-24 lg:px-32 sm:py-10 sm:pt-10"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>Blog</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>Categories</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tags</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/about/ title>About</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://github.com/srobroek title><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://keybase.io/srobroek title><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M286.17 419a18 18 0 1018 18 18 18 0 00-18-18zm111.92-147.6c-9.5-14.62-39.37-52.45-87.26-73.71q-9.1-4.06-18.38-7.27A78.43 78.43.0 00244.57 86.29c-12.41-4.1-23.33-6-32.41-5.77-.6-2-1.89-11 9.4-35L198.66 32l-5.48 7.56c-8.69 12.06-16.92 23.55-24.34 34.89a51 51 0 00-8.29-1.25c-41.53-2.45-39-2.33-41.06-2.33-50.61.0-50.75 52.12-50.75 45.88l-2.36 36.68c-1.61 27 19.75 50.21 47.63 51.85l8.93.54a214 214 0 00-46.29 35.54C14 304.66 14 374 14 429.77v33.64l23.32-29.8a148.6 148.6.0 0014.56 37.56c5.78 10.13 14.87 9.45 19.64 7.33 4.21-1.87 10-6.92 3.75-20.11a178.29 178.29.0 01-15.76-53.13l46.82-59.83-24.66 74.11c58.23-42.4 157.38-61.76 236.25-38.59 34.2 10.05 67.45.69 84.74-23.84.72-1 1.2-2.16 1.85-3.22a156.09 156.09.0 012.8 28.43c0 23.3-3.69 52.93-14.88 81.64-2.52 6.46 1.76 14.5 8.6 15.74 7.42 1.57 15.33-3.1 18.37-11.15C429 443 434 414 434 382.32c0-38.58-13-77.46-35.91-110.92zM142.37 128.58l-15.7-.93-1.39 21.79 13.13.78a93 93 0 00.32 19.57l-22.38-1.34a12.28 12.28.0 01-11.76-12.79L107 119c1-12.17 13.87-11.27 13.26-11.32l29.11 1.73a144.35 144.35.0 00-7 19.17zm148.42 172.18a10.51 10.51.0 01-14.35-1.39l-9.68-11.49-34.42 27a8.09 8.09.0 01-11.13-1.08l-15.78-18.64a7.38 7.38.0 011.34-10.34l34.57-27.18-14.14-16.74-17.09 13.45a7.75 7.75.0 01-10.59-1s-3.72-4.42-3.8-4.53a7.38 7.38.0 011.37-10.34L214 225.19s-18.51-22-18.6-22.14a9.56 9.56.0 011.74-13.42 10.38 10.38.0 0114.3 1.37l81.09 96.32a9.58 9.58.0 01-1.74 13.44zM187.44 419a18 18 0 1018 18 18 18 0 00-18-18z"/></svg></span></a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://linkedin.com/in/srobroek title><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://twitter.com/ctopope title><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></li></ul></div></label></div></div><div id=mobile-menu class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex movedown flex-col w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl sm:px-14 md:px-24 lg:px-32 sm:py-10 sm:pt-10"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>Blog</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>Categories</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tags</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/about/ title>About</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://github.com/srobroek title></a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://keybase.io/srobroek title></a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://linkedin.com/in/srobroek title></a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://twitter.com/ctopope title></a></li><li><button id=search-button-mobile class="text-base hover:text-primary-600 dark:hover:text-primary-400">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/building-a-nsx-t-nested-lab/>Building a NSX-T nested lab with Eve-NG, virtualised switches, BGP, and the kitchen sink attached.</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Building a NSX-T nested lab with Eve-NG, virtualised switches, BGP, and the kitchen sink attached.</h1><div class="mt-4 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2017-04-29 12:23:52 +0000 UTC">29 April 2017</time><span class="px-2 text-primary-500">&#183;</span><span>5967 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">29 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/srobroek/hugo-vxsan/posts/building-a-nsx-t-nested-lab/index.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"/></svg></span></a></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/nsx-t/")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">NSX-T</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/blogposts/")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">blogposts</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/nsx-t/")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">NSX-T</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/blogposts/")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">blogposts</span></span></span></div><div class="flex flex-row flex-wrap items-center"></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#prepare-and-configure-hosts>Prepare and configure hosts</a></li><li><a href=#configure-logical-routing-and-uplinks>Configure logical routing and uplinks</a></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#prepare-and-configure-hosts>Prepare and configure hosts</a></li><li><a href=#configure-logical-routing-and-uplinks>Configure logical routing and uplinks</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><p>Since my last tweet and blogpost on <a href=__GHOST_URL__/nsx-t-esxi-host-preparation-fails-errno-1-operation-not-permitted-it-is-not-safe-to-continue/>a bug in NSX-T when deploying on a nested ESXi host
</a>, i&rsquo;ve had a few requests from people to describe the actual lab setup used, the procedure and a quick-and-dirty guide to get started with NSX-T on vSphere. This blogpost will focus on the actual physical lab setup, the virtual lab setup, the physical (and virtual) networking, and the actual NSX-T implementation and setup.</p><blockquote><p>Note: This blog presumes the reader has decent skills in networking and virtualisation, as we&rsquo;ll be going full-on inception on our virtualised network. If you&rsquo;re having issues wrapping your head around nested labs, you&rsquo;re in for a ride.</p></blockquote><p>Due to the size of this blogpost a table of content has been provided.</p><ul><li><a href=#introductiontonsxt>Introduction to NSX-T</a></li><li><a href=#physicallabsetup>Physical lab setup</a></li><li><a href=#virtualnetworksetup>Virtual network setup</a></li><li><a href=#nsxtdeployment>NSX-T deployment</a><ul><li><a href=#preparation>Preparation</a></li><li><a href=#deployingthensxtmanagerandcontroller>Deploying the NSX-T Manager and controller</a></li><li><a href=#prepareandconfigurehosts>Prepare and configure hosts</a></li><li><a href=#preparetransportzonesandtransportnodes>Prepare transport zones and transport nodes</a></li><li><a href=#edgehostdeploymentandconfiguration>Edge host deployment and configuration</a></li><li><a href=#configurelogicalroutinganduplinks>Configure logical routing and uplinks</a></li><li><a href=#configureupstreamrouting>Configure upstream routing</a></li></ul></li><li><a href=#configurations>Configurations</a></li></ul><p>#Introduction to NSX-T</p><p>For the people not familiar with NSX-T (also known as &ldquo;Transformers&rdquo;, hence the spiffy product logo, and not to be confused with the Honda NSX-T), NSX-T is a new product from VMware, based on concepts from both NSX-v as well als NSX-MH (short for Multi-Hypervisor). As most people will mainly be aware of NSX for vSphere (which is what most people refer to when they talk about VMware NSX), NSX-MH was the Nicira implementation for non-vSphere platforms. While it was comparable to NSX for vSphere in some aspects, the intended user base, feature set, configuration and deployment was completely different.</p><figure><img src=__GHOST_URL__/content/images/2017/04/nsx-car-2.png alt="A network that can transform into a sports car"><figcaption>I too have always dreamed about a network that transforms into a car. Or a car with Layer 3 routing capabilities.</figcaption></figure><p>Now, with NSX-T we see a convergence of vSphere-based and non-vSphere based SDN into a single platform. While NSX-T is an entirely new product and technical comparisons cannot be made directly between NSX-T and NSX-V or NSX-MH, a lot of concepts from both NSX-v and NSX-MH have been kept and function similarly from a conceptual point of view. While feature parity is not there yet, NSX-T offers some significant benefits over NSX-v such as control plane based routing configuration, improvements to redundancy (BGP-MED and BFD come to mind), decoupling of the vCenter management layer, a significantly better API, and much more. While you&rsquo;ll mostly see NSX-v in your typiscal vSphere based datacenter environment, don&rsquo;t be surprised if you&rsquo;ll start hearing the name NSX-T much more in the coming year.</p><p>#Physical lab setup</p><p>My physical lab consists of the following components:</p><ul><li>a Supermicro server with the following specs:<ul><li>6 core Xeon-D with hyperthreading</li><li>128GB Memory</li><li>1TB Samsung 960 Pro M.2 NVMe</li><li>4x 4TB WD Red 5400RPM</li><li>2x 1GbE and 2x10Gbe (note that these are only running at 1GbE speeds because of the switch).</li></ul></li><li>A second supermicro server with a 128GB SSD, a 4 core CPU and 32GB of memory, which is mostly used if i need some physical hardware to mess around with things.</li><li>a Ubiqiuiti edgeswitch lite 24x1GbE switch.</li><li>a Ubiqiuiti edgerouter lite providing WAN connectivity and services such as firewalling and dynamic routing.</li></ul><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/lab.jpg alt></figure></p><p>On this box we run ESXi 6.5 with a vCenter server and all other related infrastructure components such as AD, NSX-v, FreeNAS, etc.</p><p>L3 connectivity is provided by the Edgeswitch Lite, with the exception of some VLANs such as DMZ or transit VLANs which are L2 up to the Edgerouter Lite. A quick overview of my network infrastructure at home can be seen below.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/vxsan.com-lan-1.png alt></figure></p><p>At the distributed vswitch level we&rsquo;ve created the following relevant port groups:</p><ul><li>2 Trunk port groups which trunk all VLANs in the ranges 23xx respectively 24xx, plus the 10xx range. These are used to trunk traffic to our nested ESXi hosts.</li><li>1 Trunk port group which trunks all VLANs in the range 10xx. This is used to connect our virtual switches running in eve-NG to the physical network.</li><li>Access port groups for transit networks, which will be used to connect the NSX Edges to the physical network.</li></ul><p>For the purposes of this lab, we are running the following components on this machine:</p><ul><li>2 Nested ESXi hosts with the following specs:<ul><li>4 virtual Nics connected to their &ldquo;site-local&rdquo; trunk ports as described above (either 23xx or 24xx). 2 Nics have been assigned to the standard interfaces (management, vMotion, storage, etc.), while two have been left unassigned. This is important for later.</li><li>2 vCPUs</li><li>12GB Memory</li><li>8 GB local storage</li><li>Connected to a Freenas provided iSCSI datastore</li></ul></li><li>1 Virtual machine running <a href=http://www.eve-ng.net/ target=_blank>Eve-NG</a><ul><li>2 virtual nics, 1 connected to my management VLAN, 1 connected to the 10xx trunk port.</li></ul></li></ul><blockquote><p>Eve-NG allows you to run virtualised network components from pretty much every major vendor inside a virtual machine, providing you with nearly all of the features that do not require hardware support.</p></blockquote><p>These ESXi machines were then connected to the vCenter and placed in their own cluster each. Note that i would normally use <a href=https://github.com/lamw/vghetto-vsphere-automated-lab-deployment target=_blank>William Lam&rsquo;s vGhetto nested lab deployment
</a>, but for this lab i wanted to build the machines myself.</p><p>So the structure we&rsquo;re getting in vCenter is as follows:</p><ul><li>vCenter</li><li>Cluster &ldquo;Nested - Site 1&rdquo;<ul><li>vesxi101.int.vxsan.com (Host)<ul><li>Nested VM for testing purposes</li></ul></li></ul></li><li>Cluster &ldquo;Nested - Site 2&rdquo;<ul><li>vesxii201.int.vxsan.com (Host)<ul><li>Nested VM for testing purposes</li></ul></li></ul></li><li>Cluster &ldquo;Physical&rdquo;<ul><li>pesxi101<ul><li>vesxi101.int.vxsan.com (VM)</li><li>vesxi201.int.vxsan.com (VM)</li></ul></li></ul></li></ul><p>If you&rsquo;re getting confused right now, consider the fact that you can leave the physical server and vCenter components out of the equation for now. They&rsquo;ll be purely used to deploy workloads on, but this will be no different than if you were to deploy all remaining components on the nested ESXi hosts.</p><h1 id=virtual-network-setup class="relative group">Virtual network setup <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#virtual-network-setup aria-label=Anchor>#</a></span></h1><p>So earlier in this blog post i told you we&rsquo;d be going full-on inception? This is where the fun really starts. Remember the Eve-NG machine we&rsquo;ve deployed earlier? We&rsquo;re running two arista vEOS QEMU images on there which are connected to the VLAN 10xx trunk port connected to the Eve-NG VM. This means that all VLAN tagging passed through the Eve-NG VM arrives at the Arista vEOS images untouched, which allows us to do VLAN trunking all the way at the virtual switch level.</p><p>Logically, this looks something like this:</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/veos-setup.png alt="Yo dawg"></figure></p><p>Conceptually, it looks something like this:</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/yodawg.jpg alt></figure></p><p>While the whole setup procedure for Eve-NG is out of scope for this blog post, there are great guides out there on how to set it up and how the product actually works. I&rsquo;ve just got two tips when deploying this:</p><ul><li>remember to enable MAC Address changes and promiscuous mode on your trunk port groups and prevent yourself from looking like an idiot.</li><li>make sure your MTUs match. This cost me a significant amount of time, but the Arista vEOS will use MTU 9214 by default on its port groups. If you have a different MTU configured on your physical switch, <strong>things will break</strong> and you&rsquo;ll be tearing out your hairs in frustration why it&rsquo;s not working. Make sure your MTU matches end-to-end.</li><li>Nested virtualised networking will perform like a drunk potato. You&rsquo;re running QEMU on top of vSphere. Your switch has no hardware offload whatsoever. You&rsquo;re most likely going to see 50+ms latency even between two switches running on the same Eve-NG machine. Don&rsquo;t expect this to perform well in any way whatsoever. This is purely for testing purposes.</li><li><strong>Do not configure BFD with this setup, shit will break in unexpected and hilarious ways involving explosions and women and children manning the lifeboats.</strong></li></ul><p>#NSX-T deployment
Now that we have our physical and our nested network set up, i&rsquo;d like to apologise for the lengthy introduction. However, I do believe that it is a required part to get all the following steps , since so much of the NSX-T configuration depends on it, and the amount of nesting involved can cause one to very easily make mistakes. However, now that we&rsquo;re done with this we can finally get to the interesting bit: deploying NSX-T!</p><p>The topology we&rsquo;re going to be building is as follows:</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsxtopology.png alt></figure></p><p>##Preparation</p><p>Start off by dowloading all the required bits from your software source, either the nicira portal or the VMware partner portal. We really need all the bits, as there&rsquo;s no automatic deployment of any component from the NSX Manager, as you&rsquo;d expect if you are familiar with NSX-v. Once you&rsquo;re done you should have the following files:</p><ul><li>nsx-manager-1.1.0.0.0.4788147.ova</li><li>nsx-controller-1.1.0.0.0.4788146.ova</li><li>nsx-edge-1.1.0.0.0.4788148.ova</li><li>nsx-edge-1.1.0.0.0.4788148.iso</li><li>nsx-lcp-1.1.0.0.0.4788198-esx65.zip</li></ul><p>All components can be directly deployed on the physical ESXi host outside of your nested lab, there is no requirement to run any components on hosts being managed by NSX itself, as it was for NSX-v. For simplicity&rsquo;s sake, i recommend to not deploy any kind of components on the nested hosts to prevent increasing the yodawg-level even more.</p><p>In addition, make sure you&rsquo;ve reserved static IP addresses for all components, and as a precaution, i&rsquo;ve also created A and PTR records for all components outside of the VTEP interfaces.</p><p>##Deploying the NSX-T Manager and controller.</p><p>In this step, we&rsquo;ll prepare our deployment by doing the following:</p><ul><li>Deploy the NSX manager.</li><li>Deploy the NSX controllers.</li><li>Join the controllers to our management plane.</li></ul><p>First, we deploy the NSX Manager. This can be done in the regular way by deploying an OVF. All the extended properties are relatively straightforward. I would recommend enabling SSH as it makes configuration significantly simpler.</p><p>Next, deploy at least one controller. Again, this is an OVF deployment without any advanced configuration properties, and enabling SSH significantly increases your quality of life.</p><p>Once the controller is deployed, log in to both the manager and the controller through either the console or through ssh and run the following commands.</p><blockquote><p>Note that if you are using putty, for some reason both the NSX manager and Controller will disconnect the session unexpectedly. I have no idea what&rsquo;s causing this, but i&rsquo;ve used bash on windows for this lab.</p></blockquote><p>On the manager:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NSX-Manager&gt; get certificate api thumbprint
</span></span><span class=line><span class=cl>973eacda1ec9ff72139dnotgettingthisonesorrya4ef7b3beb4ab6a47bc19287
</span></span></code></pre></div><blockquote><p>Note: store this thumbprint for later, you&rsquo;ll need it quite a few times.</p></blockquote><p>On the controller:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>join management-plane ip.of.nsx.mgr username admin thumbprint nsx.mgr.thumbprint
</span></span></code></pre></div><p>Enter the password for your nsx manager, wait for a minute, and ensure that your manager is connected by running the following.</p><p>On the controller:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nsxtc&gt; get managers
</span></span><span class=line><span class=cl>- 172.22.100.22    Connected
</span></span><span class=line><span class=cl>nsxtc&gt; <span class=nb>set</span> control-cluster security-model shared-secret
</span></span><span class=line><span class=cl>Secret: enteryoursecrethere
</span></span><span class=line><span class=cl>nsxtc&gt; initialize control-cluster
</span></span><span class=line><span class=cl>nsxtc&gt; get control-cluster status
</span></span><span class=line><span class=cl>is master: <span class=nb>true</span>
</span></span><span class=line><span class=cl>in majority: <span class=nb>true</span>
</span></span><span class=line><span class=cl>uuid                                 address              status
</span></span><span class=line><span class=cl>dc59f305-354f-4cdd-bf4b-f4e7f424a2b2 172.22.100.23        active
</span></span></code></pre></div><p>Ensure that is master and in majority are true, and your controller is listed.</p><p>Next, on the manager:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nsxtm&gt; get management-cluster status
</span></span><span class=line><span class=cl>Number of nodes in management cluster: <span class=m>1</span>
</span></span><span class=line><span class=cl>- 172.22.100.22    <span class=o>(</span>UUID 4221BA38-FC25-C278-C4D2-B003603F760D<span class=o>)</span> Online
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Management cluster status: STABLE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Number of nodes in control cluster: <span class=m>1</span>
</span></span><span class=line><span class=cl>- 172.22.100.23    <span class=o>(</span>UUID dc59f305-354f-4cdd-bf4b-f4e7f424a2b2<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Control cluster status: STABLE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nsxtm&gt; get management-cluster status
</span></span><span class=line><span class=cl>Number of nodes in management cluster: <span class=m>1</span>
</span></span><span class=line><span class=cl>- 172.22.100.22    <span class=o>(</span>UUID 4221BA38-FC25-C278-C4D2-B003603F760D<span class=o>)</span> Online
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Management cluster status: STABLE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Number of nodes in control cluster: <span class=m>1</span>
</span></span><span class=line><span class=cl>- 172.22.100.23    <span class=o>(</span>UUID dc59f305-354f-4cdd-bf4b-f4e7f424a2b2<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Control cluster status: STABLE
</span></span></code></pre></div><p>Ensure that all status show as stable and your controller is listed. If you wish to join more controllers, deploy them as the first one and run the following</p><p>on each new controller:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nsxtc&gt; <span class=nb>set</span> control-cluster security-model shared-secret
</span></span><span class=line><span class=cl>Secret: enteryouroriginalsecrethere
</span></span><span class=line><span class=cl>nsxtc&gt; get control-cluster certificate thumbprint
</span></span><span class=line><span class=cl>8caf5b9721446f98dc5dnotgettingthisoneeitherc9702d2fc4d6a469b42499
</span></span></code></pre></div><p>Then, on the master controller run the following for each of the new controllers:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nsxtc&gt; join control-cluster ip.of.new.controller thumbprint new.controller.thumbprint
</span></span></code></pre></div><p>Then, on each new controller run the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nsxtc&gt; activate control-cluster
</span></span></code></pre></div><h2 id=prepare-and-configure-hosts class="relative group">Prepare and configure hosts <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#prepare-and-configure-hosts aria-label=Anchor>#</a></span></h2><p>Once this is all done we can log in to the nsx manager UI. Open a browser and point it towards whatever you configured as the NSX manager&rsquo;s hostname and you&rsquo;ll be presented with the most glorious UI a piece of networking kit has had in a long while. It&rsquo;s clean, it&rsquo;s responsive, it slices, it dices, it makes julienne fries!.</p><figure><img src=__GHOST_URL__/content/images/2017/04/nsxui.png alt><figcaption>The best reason to install NSX-T? No more flash UI.</figcaption></figure><p>Next, open the fabric tab. Your hosts should be empty, so let&rsquo;s change that. Click the &ldquo;add&rdquo; button, enter a name for your host, its management IP address, your operating system (ESXi) and the username and password. Leave the thumbprint empty as this will automatically be resolved. After adding the host, wait a few minutes until everything is green and the software version shows up correctly. Note that if everything is not green and you&rsquo;re running ESXi 6.5 nested on ESXi6.5, ensure that you&rsquo;ve read /nsx-t-esxi-host-preparation-fails-errno-1-operation-not-permitted-it-is-not-safe-to-continue/ and have disabled secure boot for now.</p><p>##Prepare transport zones and transport nodes.</p><p>Next up, we&rsquo;ll prepare the transport zones. For those coming from NSX-v, the concept of transport zones is slightly different. A transport zone is no longer purely an overlay concept, but dictates which networks can be connected to from a hypervisor or an edge cluster. As such, transport zones come in two forms: Overlay or VLAN transport zones.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsxtz.png alt></figure></p><p>An Overlay transport zone is what ties the transport nodes together and transports the actual virtual wires. a VLAN transport zone is used for your Tier-0 edges to connect the virtualised network to the physical network.</p><p>First off, start with creating an overlay transport zone. Open the Fabric -> Transport zones menu and click add.</p><p>Enter a name for your transport zone, an optional description and a host switch name. The host switch name will be used to create a mapping between physical nics on your ESXi hosts and either logical router nics or VTEP interfaces.</p><p>Next, create at least one IP pool for your VTEP interfaces. Open Inventory -> Groups -> IP Pools and create at least one IP pool. As i&rsquo;ve created two different &ldquo;sites&rdquo; in my lab, i&rsquo;ve created two IP pools using distinct IP subnets. This part is very similar to NSX-v&rsquo;s IP pool creation: enter a name, add an IP range, gateway, subnet and optional DNS servers.</p><p>When the IP pools are created, open Fabric -> Profiles and create a new Uplink Profile. The uplink profile determines the VTEP interface configuration. While you can use the default, it is recommended to create your own. I&rsquo;ve provided an over overview of the uplink profiles i&rsquo;ve created to serve as an example, but right now you only need one or two (depending on whether you&rsquo;re using separate L3 domains for your ESXi hosts:</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsxup.png alt></figure></p><p>Enter a name and an optional description. If you want LAGs, configure a lag (which has its use cases for physical edges, but that&rsquo;s something we&rsquo;re not going into right now). Set a Teaming policy, and depending on your teaming policy set active and standby uplinks as uplink-1 and uplink-2.</p><p>Next, set a transport VLAN which will be your VTEP vlan, and set the MTU to a minimum of 1600.</p><p>Once the Uplink profiles are created, add your ESXi nodes as a transport node. A transport node defines a node as participating in your network fabric. Open Fabric -> Nodes -> Transport Nodes and click &ldquo;Add&rdquo;.</p><p>Enter a name (recommended to use the name of your host), select your ESXi host from the dropdown, and select the Overlay transport zone you&rsquo;ve just created. Then, in the new node switch enter your host switch name as the host switch name you&rsquo;ve configured in the transport zone, and in the Uplink profile enter a name for your VTEP. For the Uplink profile, select your Uplink profile you&rsquo;ve created, and for IP assignment select either &ldquo;Use IP Pool&rdquo;, &ldquo;Use DHCP&rdquo; or &ldquo;Use Static IP List&rdquo;. The first two should speak for itself if you have NSX-v experience, the third one is new and allows you to configure a static IP directly on a host.</p><p>If you are using DHCP ensure you have your DHCP server set up, if you are using IP pools click the &ldquo;Create and use new IP pool&rdquo; and enter a name and a subnet in the same way you&rsquo;d do this in NSX-v.</p><p>Next, in the physical NICs section, select a physical device and assign it an uplink from your uplink profile. Remember when i said to leave two nics unused in your nested ESXi host? This is the reason why, as NSX-T needs dedicated physical NICs for its VTEP interfaces.</p><p>In our case we add vmnic3 and vmnic4 to be our uplink-1 and uplink-2 respectively. Note that there is a weird UI bug when adding and selecting a second vmnic from the dropdown, but you can enter the name manually.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsxtn.png alt></figure></p><p>After waiting a short while the transport node should show up and its status should be &ldquo;Success&rdquo;. If you log in to vSphere and open the physical adapter configuration of your ESXi host it should show the physical nic is assigned to your overlay switch, even though the switch itself does not appear anywhere within vSphere. I believe this is a quality of life issue and it would be nice to show the switch itself as an opaque switch, but for now we can use this to validate the host is actually connected to the NSX-T opaque host switch.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsxpa.png alt></figure></p><p>Now that we have prepared our cluster, let&rsquo;s deploy some edge hosts!</p><p>##Edge host deployment and configuration</p><p>Before we start with the actual edge host configuration, there are some things to consider if you&rsquo;re coming from NSX-v. Whereas an Edge is a virtual appliance performing actual routing, natting, and advanced services inside the VM, the concept of an edge is slightly different in NSX-T.</p><p>An edge is either a virtual or physical form factor server, which serves as the control plane for routing and advanced services in NSX-T. Whereas in NSX-v one would deploy an edge per router, NSX-T virtualises these resurces as containers running inside an edge node, also named VRFs. So instead of having multiple edges, a NSX-T environment will only have a limited amount of edges which then create resources such as Tier-0 and Tier-1 routers, DHCP servers and NAT services on-demand. Not only does this significantly reduce VM sprawl, it also simplifies configuration, allows for rapid provisioning and reduces complexity of the environment.</p><p>Edges can be deployed in multiple ways (OVA deployment, PXEBoot, ISO installation. In this deployment, we&rsquo;ll focus on the OVA deployment, but from a technical point of view they are all equal.</p><p>Start off with deploying the edge through the OVA deployment. During the deployment one can select the size, which determines the throughput and performance of advanced services. For this deployment we&rsquo;ll select small as it is only a Poc and our resources are limited.</p><p>When it comes to the selection of network ports, you have to follow a specific setup. While this can be changed afterwards, it is recommended to do it correct at deployment time:</p><ul><li>Network 0 should be connected to your management VLAN port group as this will be used to configure the edge and log in to it over SSH.</li><li>Network 1 should be connected to either your trunk or a dedicated VTEP port group.</li><li>Network 2 and 3 should be connected to either individiual /31 transit VLAN port groups or a trunk containing your uplinks. This design choice is entirely dependent on your Tier-0 configuration, for this example we&rsquo;ll use dedicated port groups for transit purposes.</li></ul><p>Just as with NSX-v it is recommended to set these transit port groups to active/unused and unused/active and have the actual routing protocol handle redundancy. Fortunately we&rsquo;ve already preprovisioned these transit VLANs for these kind of use cases, if not you&rsquo;ll have to build them yourself.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsxtransit.png alt></figure></p><p>Once the edges are deployed (you have deployed two, didn&rsquo;t you?), log in to the edge over SSH if you&rsquo;ve enabled that during the deployment, and run the following</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nsxte-0&gt; join management-plane ip.of.nsx.mgr username admin thumbprint nsxt.mgr.thumbprint
</span></span></code></pre></div><p>if you don&rsquo;t have the thumbprint anymore, you can retrieve it from the manager with the command <code>get certificate api thumbprint</code>.</p><p>You should get a message stating that the edge succesfully joined the NSX fabric as a fabric node with its UUID. repeat this step for each edge node.</p><p>When you log back in to the NSX manager UI, you should see your edge nodes under Fabric -> Nodes -> Edges. Note that LCP connectivity is not available, this is entirely normal until the host is joined as a transport node. Next up, we&rsquo;ll prepare the edge as an actual transport node and join it to the transport zones.</p><p>First off, we&rsquo;ll need to create transport zones for your VLAN uplinks. Remember i told you how transport zones are different from NSX-v? This is where that comes in. When we created a transport zone for logical switching earlier, we selected the type as Overlay. Now, we&rsquo;ll go to Fabric -> Transport zone and create 4 transport zones, one for each of our transit VLANs.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsxtzvlan.png alt></figure></p><p>After the transport zones have been created, add your Edge node as a transport node to join it to the fabric. Open Fabric -> Nodes -> Transport Nodes and add a new transport node.</p><p>This procedure is the same as for an ESXi host with the difference that this edge node will be connected to multiple overlays. If you consider your typical NSX-v design, you&rsquo;d have port groups for transit VLANs and a VTEP vlan on your vSphere edge cluster, and this is very similar.</p><p>Enter a name and select your node, then in the transport zones field select your overlay and two VLAN transport zones. Note that you can add as much transport zones to an edge transport node as you wish, but for our use case we&rsquo;re using two VLAN transport zones and a single overlay zone.</p><p>Next, we add the Node switches. This is very similar to the ESXi transport node configuration, however we need to create multiple node switches, one for each transport zone. When you&rsquo;ve configured the first node switch, click &ldquo;Add new node switch&rdquo; at the bottom to create new ones for each transport zone. Again, the edge switch names must match what you&rsquo;ve configured in the transport zone. When creating a VLAN backed node switch, you cannot configure an IP profile, because a VLAN transport zone does not require VTEP interfaces.</p><p>Also note that for virtual edge transport nodes, only a single virtual nic can be bound to a tz overlay. For virtual edges, this is something that would be resolved through your distributed switch to which the virtual appliance is connected. For physical edges you can use active/standby uplinks as normal. This is also the reason we&rsquo;ve created separate uplink profiles for our edges.</p><p>When you&rsquo;re done, the edge transport node should look something like this:</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsxtedge.png alt></figure></p><p>When the status of the edges is all OK (check for the LCP status in the edge panel, note that this may take a few minutes), start creating an edge cluster. Open the Fabric -> Nodes -> Edge clusters panel and add a new edge cluster. Note that this is mandatory, even if you only have a single edge transport node.</p><p>Enter the name, an optional description and select the standard edge cluster profile. Next, click edit next to the transport nodes, select &ldquo;Virtual machine&rdquo; and select both edges. If you&rsquo;ve deployed edges as a physical machine (which can still be virtual but needs to be deployed through the ISO or PXEBoot), they&rsquo;ll appear as physical machines.</p><p>Once the edge cluster is created, we can actually start creating logical routers. Open the Routing panel, then add a new router and select &ldquo;New Tier-0 router&rdquo;. Tier-0 routers are what connect your physical network to your virtualised network fabric. Unlike the NSX Edge service gateway however, the Tier-0 router is fully distributed and purely functions as a physical to virtual perimeter router. As such, it does not support the features that a Tier-1 router does.</p><p>Enter a name and an optional description, select your edge cluster and select your high availability mode. This choice is up to you, active-standby is comparable to NSX-v&rsquo;s HA deployment (but without the long failover times), whereas active-active will configure ECMP to your physical routers. As we like to explore ECMP, we&rsquo;ll select active-active.</p><p>When deploying the logical router, you&rsquo;ll notice the speed at which it deploys. As there are no appliances or virtual machines to deploy or boot, new routing instances can literally be configured at the speed at which a container can be spun up, which will make automated deployments significantly easier.</p><p>Next, create a Tier-1 router. Tier-1 routers are what connects your logical switches to your tier-0 routers and provide advanced services such as DHCP and NAT, while still being fully distributed. They can be compared as a hybrid between NSX-v&rsquo;s distributed logical router and edge service gateway, with all routing being performed in-kernel while stateful services have their control plane on the edge service router which exists on the edge transport node.</p><p>When creating a Tier-1 router enter a name and optional description and select your upstream Tier-0 Router. This automatically creates internal logical switches between the Tier-0 and Tier-1 router. Next, select your edge cluster, edge cluster members and preferred member. Due to the way Tier-1 routers work, they cannot be configured as active-active and we&rsquo;ll need to select a primary member on which services run.</p><p>When both Tier-0 and Tier-1 routers have been created, your router should look something like this.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsx-lr.png alt></figure></p><h2 id=configure-logical-routing-and-uplinks class="relative group">Configure logical routing and uplinks <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#configure-logical-routing-and-uplinks aria-label=Anchor>#</a></span></h2><p>Next to create connectivity, we&rsquo;ll create logical switches. This is very comparable to NSX-v, with one major difference: VLAN backed port groups are also logical switches, as opposed to port groups in vSphere.</p><p>Open the switching panel and start adding logical switches. For this demo we&rsquo;ve created the following logical switches:</p><ul><li>LS1</li><li>LS2</li><li>vlan-1012</li><li>vlan-1014</li><li>vlan-1016</li><li>vlan-1018</li></ul><p>The LS logical switches are created in the tz-overlay transport zone, and the vlan logical switches are created in their respective vlan transport zone. The VLAN logical switches have been created with VLAN tag 0, as these are connected to a port group configured as an access port. If you were to connect these to a trunk port a VLAN tag msut be configured.</p><p>Note that for the logical switches you must select a Replication mode, either Hierarchical Two-Tier or Head. Hierarchical Two-Tier is very comparable to NSX-v&rsquo;s Hybrid replication mode where a UTEP is elected in each L2 broadcast domain which replicates trafic to other broadcast domains. Head is very similar to unicast replication mode. Note that there is no pure multicast option anymore. If you want to, switching profiles can be configured which allow for advanced security, monitoring and traffic shaping options such as DSCP/CoS, Spoofguard, ARP and DHCP snooping, etc.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsx-ls.png alt></figure></p><p>When configured, your logical switches should look comparable to this.</p><p>Next, go back to your router overview. Click the Tier-1 Router name and select configuration. Add a Logical Router port, enter a name, select your logical switch to connect the port to and configure an IP address and subnet mask.</p><p>If you open the switching -> Ports panel, you should see your logical routers being connected to your logical switch. When you click the attachment you can see the details about the logical router&rsquo;s port. Note that in this example i&rsquo;ve also created DHCP services on the logical switches, but this is not required and left as an exercise for the reader.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsx-ports.png alt></figure></p><p>Now that your Tier-1 router has been configured, we can test basic connectivity. Create virtual machines on your nested ESXi hosts, and when connecting their virtual NICs to a network, you should see two new port groups with a unique interface. This is an opaque switch and is unique to NSX-T. It cannot be managed or configured from vSphere, is unique to each host and is completely independent of vCenter.</p><p>Confirm that - once an IP address has been configured on the virtual machines - that you can ping the Tier-1 logical router IP address, and the VM on the other logical switch.</p><p>Now that we&rsquo;ve configured connectivity between logical switches, it&rsquo;s time to configure actual physical connectivity. Open the Routing panel, and select the Tier-0 router we&rsquo;ve configured earlier. Add a new router port, enter a name and optional description and select the uplink type. Next, select the first transport node and the first transit VLAN logical switch. The configuration should look something like this.</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsx-rp.png alt></figure></p><p>Repeat these steps for each transit logical switch, and ensure the correct logical switches are connect to the correct transport mode.</p><p>When finished, the result should be one downlink port to your Tier-1 router and four uplink ports to your VLAN logical switches:</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsx-transitlp.png alt></figure></p><p>##Configure upstream routing</p><p>Next, enter the Routing panel in the Tier-0 router and select BGP. First, edit the global BGP configuration. In our case we&rsquo;ll set BGP to enabled, enable ECMP, leave graceful restart disabled and set our local AS to 65538. Next, add a new Neighbour.</p><p>Enter the following information:</p><p>Neighbour address: the IP address of your BGP neighbor.
Local Address: select only the transit VLAN your BGP neighbour is connected to.
Remote AS: Enter the remote AS of your neighbor.
Keep Alive Time: This is dependent on the equipment you are peering with.
Hold Down time: This is dependent on the equipment you are peering with.</p><p>When all of this has been configured, we can log in to either of the Tier-0 router appliances and run the following commands</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>get logical-router
</span></span></code></pre></div><p>look for the SERVICE_ROUTER_TIER_0 and note down its VRF. This is the routing engine responsible for BGP peering. Next, run <code>vrf vrfid</code> - where vrfid is the VRF ID of the Tier-0 service router - to enter the VRF.</p><p>Next, run <code>get route bgp</code> to confirm that we are receiving routes from our upstream physical devices, and we are in fact getting ECMP enabled routes</p><pre tabindex=0><code>nsxte-0(tier0_sr)&gt; get route bgp

Flags: c - connected, s - static, b - BGP, ns - nsx_static
nc - nsx_connected, rl - router_link, t0n: Tier0-NAT, t1n: Tier1-NAT


b    0.0.0.0/0            [20/0]        via 172.20.255.12
b    0.0.0.0/0            [20/0]        via 172.20.255.14
b    172.16.0.0/12        [20/0]        via 172.20.255.12
b    172.16.0.0/12        [20/0]        via 172.20.255.14
b    192.168.0.0/16       [200/0]       via 0.0.0.0
b    192.168.1.0/24       [20/0]        via 172.20.255.12
b    192.168.1.0/24       [20/0]        via 172.20.255.14
b    217.63.252.0/23      [20/0]        via 172.20.255.12
b    217.63.252.0/23      [20/0]        via 172.20.255.14
</code></pre><p>Note that we are also getting 192.168/24 routes, these are in fact OSPF routes for another lab redistributed by NSX-v into BGP by my physical router.</p><p>The next step is to configure route redistribution from our Tier-1 to our Tier-0. One important thing to note is that these routes are distributed through the NSX-T control plane and not through a routing protocol.</p><p>Open the Tier-1 router, click routing and select &ldquo;Route advertisement&rdquo;. First, configure the global options. We&rsquo;ll enable route advertisement and advertise all NSX connected routes. We won&rsquo;t advertise NAT routes or Static routes since we&rsquo;re not using those in our lab.</p><p>When we run <code>get route</code> on our Tier-0 service router VRF, we can see that two additional routes have been injected into the routing table.</p><pre tabindex=0><code>nsxte-0(tier0_sr)&gt; get route

Flags: c - connected, s - static, b - BGP, ns - nsx_static
nc - nsx_connected, rl - router_link, t0n: Tier0-NAT, t1n: Tier1-NAT

Total number of routes: 11

b    0.0.0.0/0            [20/0]        via 172.20.255.12
b    0.0.0.0/0            [20/0]        via 172.20.255.14
ns   10.1.0.0/24          [3/0]         via 169.254.0.1
ns   10.2.0.0/24          [3/0]         via 169.254.0.1
rl   100.64.0.0/31        [0/0]         via 169.254.0.1
c    169.254.0.0/28       [0/0]         via 169.254.0.2
b    172.16.0.0/12        [20/0]        via 172.20.255.12
b    172.16.0.0/12        [20/0]        via 172.20.255.14
c    172.20.255.12/31     [0/0]         via 172.20.255.13
c    172.20.255.14/31     [0/0]         via 172.20.255.15
b    192.168.0.0/16       [200/0]       via 0.0.0.0
b    192.168.1.0/24       [20/0]        via 172.20.255.12
b    192.168.1.0/24       [20/0]        via 172.20.255.14
b    217.63.252.0/23      [20/0]        via 172.20.255.12
b    217.63.252.0/23      [20/0]        via 172.20.255.14
</code></pre><p>The ns routes, which is a special type for NSX routing have been propagated by the Tier-1 logical router into the Tier-0 logical router routing table.</p><p>The last step we need to perform is to redistribute our routes into the physical world. Open the Tier-0 Router, selecting Routing and open &ldquo;Route redistribution&rdquo;. First, ensure that route redistribution is enabled. Next, add a new route redistribution. Enter a name, an optional description and select your sources. In our case we&rsquo;re only selecting &ldquo;NSX Static&rdquo; as we have no need to distribute natted or manual static routes. Note that NSX static routes are auto-configured routes redistributed into the fabric, whereas static routes are manually configured static routes on the Tier-1 router. This can cause some confusion and initially cost me a good 30 minute to discover why route redistribution was not working..</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsx-rr.png alt></figure></p><p>As we can see on the arista switches we&rsquo;re receiving our 10.1.0.0/24 and 10.2.0.0/24 routes:</p><pre tabindex=0><code>localhost#show ip route bgp

VRF name: default
Codes: C - connected, S - static, K - kernel,
       O - OSPF, IA - OSPF inter area, E1 - OSPF external type 1,
       E2 - OSPF external type 2, N1 - OSPF NSSA external type 1,
       N2 - OSPF NSSA external type2, B I - iBGP, B E - eBGP,
       R - RIP, I L1 - ISIS level 1, I L2 - ISIS level 2,
       O3 - OSPFv3, A B - BGP Aggregate, A O - OSPF Summary,
       NG - Nexthop Group Static Route, V - VXLAN Control Service

Gateway of last resort:
 B E    0.0.0.0/0 [200/0] via 172.20.255.8, Vlan1008

 B E    10.1.0.0/24 [200/0] via 172.20.255.17, Vlan1016
 B E    10.2.0.0/24 [200/0] via 172.20.255.17, Vlan1016
 B E    172.20.255.0/31 [200/0] via 172.20.255.8, Vlan1008
 B E    172.20.255.2/31 [200/0] via 172.20.255.8, Vlan1008
 B E    172.20.255.4/31 [200/0] via 172.20.255.8, Vlan1008
 B E    172.20.255.6/31 [200/0] via 172.20.255.8, Vlan1008
 B E    172.20.255.10/31 [200/0] via 172.20.255.8, Vlan1008
 B E    172.20.0.0/16 [200/0] via 172.20.255.8, Vlan1008
 B E    172.21.100.0/24 [200/0] via 172.20.255.8, Vlan1008
 B E    172.21.101.0/24 [200/0] via 172.20.255.8, Vlan1008
 B E    172.21.102.0/24 [200/0] via 172.20.255.8, Vlan1008
 B E    172.22.0.0/16 [200/0] via 172.20.255.8, Vlan1008
 B E    172.23.0.0/16 [200/0] via 172.20.255.8, Vlan1008
 B E    172.24.0.0/16 [200/0] via 172.20.255.8, Vlan1008
 B E    192.168.1.0/24 [200/0] via 172.20.255.8, Vlan1008
 B E    192.168.0.0/16 [200/0] via 172.20.255.19, Vlan1018
 B E    217.63.252.0/23 [200/0] via 172.20.255.8, Vlan1008
</code></pre><p>And that&rsquo;s it! To prove that we&rsquo;ve got connectivity i&rsquo;ve performed a HTTP GET to my own blog, which shows that we can connect to an external network!</p><p><figure><img class="my-0 rounded-md" src=__GHOST_URL__/content/images/2017/04/nsx-liftoff.png alt></figure></p><p>Hopefully this has helped you in understanding how NSX-T works, the differences between NSX-v and NSX-T and how you too can build your own multi-site NSX-T lab with relatively limited resources by using nested networking equipment and nested hypervisors.</p><h1 id=configurations class="relative group">Configurations <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#configurations aria-label=Anchor>#</a></span></h1><p>For completeness, the arista vEos configurations have been provided below:</p><p>vEOS 1</p><pre tabindex=0><code>! Command: show running-config
! device: localhost (vEOS, EOS-4.18.1F)
!
! boot system flash:/vEOS-lab.swi
!
transceiver qsfp default-mode 4x10G
!
spanning-tree mode mstp
!
no aaa root
!
username admin role network-admin secret sha512 redacted 
!
vlan 1008,1016,1018,2200,2203
!
interface Ethernet1
   no switchport
   ip address 172.31.255.1/31
!
interface Ethernet2
   mtu 9214
   switchport access vlan 2200
   switchport mode trunk
!
interface Ethernet3
!
interface Management1
!
interface Vlan1008
   ip address 172.20.255.9/31
!
interface Vlan1016
   ip address 172.20.255.16/31
!
interface Vlan1018
   ip address 172.20.255.18/31
!
interface Vlan2000
!
interface Vlan2200
   mtu 9214
   ip address 172.22.100.135/24
!
interface Vlan2203
   ip address 172.22.103.145/24
!
ip routing
!
router bgp 65536
   neighbor pg-nsxt-1 peer-group
   neighbor pg-nsxt-1 remote-as 65538
   neighbor pg-nsxt-1 maximum-routes 12000
   neighbor 172.20.255.8 remote-as 65535
   neighbor 172.20.255.8 maximum-routes 12000
   neighbor 172.20.255.17 peer-group pg-nsxt-1
   neighbor 172.20.255.19 peer-group pg-nsxt-1
   aggregate-address 172.16.0.0/12 summary-only
!
end
</code></pre><p>vEOS2</p><pre tabindex=0><code>localhost(config-router-bgp)#show running-config
! Command: show running-config
! device: localhost (vEOS, EOS-4.18.1F)
!
! boot system flash:/vEOS-lab.swi
!
transceiver qsfp default-mode 4x10G
!
spanning-tree mode mstp
!
no aaa root
!
username admin role network-admin secret sha512 redacted
!
vlan 1010,1012,1014,2200,2203
!
interface Ethernet1
   no switchport
   ip address 172.31.255.0/31
!
interface Ethernet2
   switchport access vlan 2200
   switchport mode trunk
!
interface Ethernet3
!
interface Management1
!
interface Vlan1010
   ip address 172.20.255.11/31
!
interface Vlan1012
   ip address 172.20.255.12/31
!
interface Vlan1014
   ip address 172.20.255.14/31
!
interface Vlan2200
   mtu 9214
   ip address 172.22.100.136/24
!
interface Vlan2203
   ip address 172.22.103.146/24
!
ip routing
!
router bgp 65537
   neighbor pg-nsxt-1 peer-group
   neighbor pg-nsxt-1 remote-as 65538
   neighbor pg-nsxt-1 maximum-routes 12000
   neighbor 172.20.255.10 remote-as 65535
   neighbor 172.20.255.10 maximum-routes 12000
   neighbor 172.20.255.13 peer-group pg-nsxt-1
   neighbor 172.20.255.15 peer-group pg-nsxt-1
   aggregate-address 172.16.0.0/12 summary-only
!
end
</code></pre></div><script>var liked_article=!1,oid,id,viewed,oid_likes,id_likes,liked;typeof auth!="undefined"&&(oid="views_posts/building-a-nsx-t-nested-lab/index.md",id=oid&&oid.replaceAll("/","-"),viewed=localStorage.getItem(id),viewed||auth.signInAnonymously().then(()=>{var e=db.collection("views").doc(id);localStorage.setItem(id,!0),e.get().then(e=>{e.exists?db.collection("views").doc(id).update({views:firebase.firestore.FieldValue.increment(1)}):db.collection("views").doc(id).set({views:1})}).catch(e=>{console.log("Error getting document:",e)})}).catch(e=>{var t=e.code,n=e.message;console.error(t,n)}),oid_likes="likes_posts/building-a-nsx-t-nested-lab/index.md",id_likes=oid_likes&&oid_likes.replaceAll("/","-"),liked=localStorage.getItem(id_likes),liked&&(liked_article=!0,document.querySelectorAll("span[id='likes_button_heart']")[0].style.display="",document.querySelectorAll("span[id='likes_button_emtpty_heart']")[0].style.display="none",document.querySelectorAll("span[id='likes_button_text']")[0].innerText="Remove Like"));function like_article(e){auth.signInAnonymously().then(()=>{var t=db.collection("likes").doc(e);t.get().then(t=>{liked_article=!0,localStorage.setItem(e,!0),document.querySelectorAll("span[id='likes_button_heart']")[0].style.display="",document.querySelectorAll("span[id='likes_button_emtpty_heart']")[0].style.display="none",document.querySelectorAll("span[id='likes_button_text']")[0].innerText="Remove Like",t.exists?db.collection("likes").doc(e).update({likes:firebase.firestore.FieldValue.increment(1)}):db.collection("likes").doc(e).set({likes:1})}).catch(e=>{console.log("Error getting document:",e)})}).catch(e=>{var t=e.code,n=e.message;console.error(t,n)})}function remove_like_article(e){auth.signInAnonymously().then(()=>{var t=db.collection("likes").doc(e);t.get().then(t=>{liked_article=!1,localStorage.removeItem(e),document.querySelectorAll("span[id='likes_button_heart']")[0].style.display="none",document.querySelectorAll("span[id='likes_button_emtpty_heart']")[0].style.display="",document.querySelectorAll("span[id='likes_button_text']")[0].innerText="Like",t.exists?db.collection("likes").doc(e).update({likes:firebase.firestore.FieldValue.increment(-1)}):db.collection("likes").doc(e).set({likes:0})}).catch(e=>{console.log("Error getting document:",e)})}).catch(e=>{var t=e.code,n=e.message;console.error(t,n)})}function process_article(){var e="likes_posts/building-a-nsx-t-nested-lab/index.md",t=e&&e.replaceAll("/","-");liked_article?remove_like_article(t):like_article(t)}</script></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Sjors Robroek</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/srobroek target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://keybase.io/srobroek target=_blank aria-label=Keybase rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M286.17 419a18 18 0 1018 18 18 18 0 00-18-18zm111.92-147.6c-9.5-14.62-39.37-52.45-87.26-73.71q-9.1-4.06-18.38-7.27A78.43 78.43.0 00244.57 86.29c-12.41-4.1-23.33-6-32.41-5.77-.6-2-1.89-11 9.4-35L198.66 32l-5.48 7.56c-8.69 12.06-16.92 23.55-24.34 34.89a51 51 0 00-8.29-1.25c-41.53-2.45-39-2.33-41.06-2.33-50.61.0-50.75 52.12-50.75 45.88l-2.36 36.68c-1.61 27 19.75 50.21 47.63 51.85l8.93.54a214 214 0 00-46.29 35.54C14 304.66 14 374 14 429.77v33.64l23.32-29.8a148.6 148.6.0 0014.56 37.56c5.78 10.13 14.87 9.45 19.64 7.33 4.21-1.87 10-6.92 3.75-20.11a178.29 178.29.0 01-15.76-53.13l46.82-59.83-24.66 74.11c58.23-42.4 157.38-61.76 236.25-38.59 34.2 10.05 67.45.69 84.74-23.84.72-1 1.2-2.16 1.85-3.22a156.09 156.09.0 012.8 28.43c0 23.3-3.69 52.93-14.88 81.64-2.52 6.46 1.76 14.5 8.6 15.74 7.42 1.57 15.33-3.1 18.37-11.15C429 443 434 414 434 382.32c0-38.58-13-77.46-35.91-110.92zM142.37 128.58l-15.7-.93-1.39 21.79 13.13.78a93 93 0 00.32 19.57l-22.38-1.34a12.28 12.28.0 01-11.76-12.79L107 119c1-12.17 13.87-11.27 13.26-11.32l29.11 1.73a144.35 144.35.0 00-7 19.17zm148.42 172.18a10.51 10.51.0 01-14.35-1.39l-9.68-11.49-34.42 27a8.09 8.09.0 01-11.13-1.08l-15.78-18.64a7.38 7.38.0 011.34-10.34l34.57-27.18-14.14-16.74-17.09 13.45a7.75 7.75.0 01-10.59-1s-3.72-4.42-3.8-4.53a7.38 7.38.0 011.37-10.34L214 225.19s-18.51-22-18.6-22.14a9.56 9.56.0 011.74-13.42 10.38 10.38.0 0114.3 1.37l81.09 96.32a9.58 9.58.0 01-1.74 13.44zM187.44 419a18 18 0 1018 18 18 18 0 00-18-18z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/srobroek target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/ctopope target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/posts/nsx-t-esxi-host-preparation-fails-errno-1-operation-not-permitted-it-is-not-safe-to-continue/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">NSX-T Nested ESXi host preparation fails.</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2017-04-21 14:06:34 +0000 UTC">21 April 2017</time></span></span></a></span>
<span><a class="flex text-right group" href=/posts/building-the-virarium-or-you-know-normal-people-have-aquariums-part1/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Building the Virarium 2.0 - or "You know, normal people just have aquariums." - Part 1</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2017-05-14 10:42:01 +0000 UTC">14 May 2017</time></span></span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div class="pointer-events-none absolute top-[100vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href title></a></li></ul></nav><div class="flex items-center justify-between"><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://nunocoracao.github.io/blowfish/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.1d5a3f4a9583d31668d777478074c0526be93b07cc79f303dce0ecc502226b04072b27e78185a927a25fd226da1de5a457c13cb89c85596512bd500006ee7602.js integrity="sha512-HVo/SpWD0xZo13dHgHTAUmvpOwfMefMD3ODsxQIiawQHKyfngYWpJ6Jf0ibaHeWkV8E8uJyFWWUSvVAABu52Ag=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://vxsan.com><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>